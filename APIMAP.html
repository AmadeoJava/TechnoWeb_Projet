<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="#" />
    <!-- Nous chargeons les fichiers CDN de Leaflet. Le CSS AVANT le JS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
      integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css"
    />
    <style type="text/css">
      #map {
        /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
        height: 720px;
        width: 1080px;
      }
    </style>
    <title>Carte</title>
  </head>
  <body>
    <div id="map">
      <!-- Ici s'affichera la carte -->
    </div>

    <!-- Fichiers Javascript -->
    <script
      src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
      integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
      crossorigin=""
    ></script>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
    />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
    <script type="text/javascript">
      // On initialise la latitude et la longitude de Paris (centre de la carte)
      var lat = 43.93;
      var lon = 2.14;
      var macarte = null;
      // Fonction d'initialisation de la carte
      function initMap() {
        // Créer l'objet "macarte" et l'insèrer dans l'élément HTML qui a l'ID "map"
        macarte = L.map("map").setView([lat, lon], 15);
        // Leaflet ne récupère pas les cartes (tiles) sur un serveur par défaut. Nous devons lui préciser où nous souhaitons les récupérer. Ici, openstreetmap.fr
        L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png", {
          // Il est toujours bien de laisser le lien vers la source des données
          attribution:
            'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',
          minZoom: 1,
          maxZoom: 20,
        }).addTo(macarte);
      }
      const locationOptions = {
            maximumAge: 10000,
            timeout: 5000,
            enableHighAccuracy: true
        };
      if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(handleLocation,handleLocationError, locationOptions);
      } else {
          /* Le navigateur n'est pas compatible */
          alert("Géolocalisation indisponible");
      }

      function handleLocation(position) {
          /* Zoom avant de trouver la localisation */
          /* Centre la carte sur la latitude et la longitude de la localisation de l'utilisateur */
         console.log(position.coords.latitude);
         console.log(position.coords.longitude);
         addMarqueur(position.coords.latitude,position.coords.longitude);
      }
      function handleLocationError(msg) {
            alert("Erreur lors de la géolocalisation");
        }
      function addMarqueur(latitude,longitude){

        return L.marker([latitude,longitude]).addTo(macarte);
      }
      window.onload = function () {
        // Fonction d'initialisation qui s'exécute lorsque le DOM est chargé

        initMap();

        const optionsV1 = { profile: "mapbox/driving" };
        const optionsV2 = { profile: "mapbox/walking" };
        var myRouter = L.Routing.control({
          geocoder: L.Control.Geocoder.nominatim(),
          waypoints: [
            L.latLng(43.928470611572, 2.1426000595093),
            L.latLng(43.94261, 2.14822),
          ],

          router: L.Routing.mapbox(
            "pk.eyJ1IjoiYXplYXpkcXp6c2ppaGdocXpqa2giLCJhIjoiY2wxNTQzcnpvMGdydTNvcXpreDBmbnZxNiJ9.hKjHX7H6ZbnO4Gt0gH_sAg",
            optionsV2
          ),
        }).addTo(macarte);
        L.easyButton('<img src="pic.png">', function (btn, map) {
          myRouter.getRouter().options.profile = "mapbox/driving";
          myRouter.route();
        }).addTo(macarte);
      };
    </script>
  </body>
</html>
