<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js" integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<style>
    #tableau {
        width: 90%;
        height: 90%;
    }
    
    #myChart {
        background-color: rgb(46, 156, 219);
    }
</style>

<body>

    <div id="tableau">
        <canvas id="myChart"></canvas>
    </div>



    <script>
        // https://tobiasahlin.com/blog/chartjs-charts-to-get-you-started/#9-mixed-chart

        function aleatoireListe(n) {
            var L = [];
            for (let i = 0; i < n; i++) {
                L.push(Math.floor(Math.random() * 10))
                moyenne += L[i];
            }
            moyenne /= n;
            return L;
        }

        function ascListe(n) {
            var L = [];
            for (let i = 1; i < n + 1; i++) {
                L.push(i)
            }
            return L;
        }

        function ligne(d) {
            var m = d[0];
            console.log(m);
            donneesline.push(m);
            for (let i = 1; i < d.length; i++) {
                m = (m * (i - 1) + d[i]) / (i);
                console.log(m);
                donneesline.push(m);
            }
        }

        var moyenne = 0;
        var taille = 10;
        var l = ascListe(taille);
        var donneesbar = aleatoireListe(taille);
        var donneesline = [];


        var chartColors = {
            red: "rgb(190,70,55)",
            blue: 'rgb(220, 220, 0)',
            pire: 'rgb(255,0,0)'
        };

        var ctx = document.getElementById("myChart").getContext("2d");

        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: l,
                datasets: [{
                    label: 'Nombre de visiteurs',
                    backgroundColor: [
                        chartColors.red
                    ],
                    data: donneesbar
                }],
            }
        });

        var colorChangeValue = moyenne;
        console.log(moyenne);
        var dataset = myChart.data.datasets[0];
        mini = dataset.data[0]
        mi = [0]
        for (var i = 0; i < donneesbar.length; i++) {
            if ((parseInt(dataset.data[i])) < (parseInt(mini))) {
                mini = dataset.data[i];
                mi = [i];
            } else if ((parseInt(dataset.data[i])) == (parseInt(mini))) {
                mi.push(i);
            }
            if ((parseInt(dataset.data[i])) > (parseInt(colorChangeValue))) {
                dataset.backgroundColor[i] = chartColors.blue;
            } else {
                dataset.backgroundColor[i] = chartColors.red;
            }
        }
        //mi.uniq();
        ma = mi;
        mi = [...new Set(ma)]
        for (let i = 0; i < mi.length; i++) {
            dataset.backgroundColor[mi[i]] = chartColors.pire;
        }
        console.log(mi);
        /*
        var e = dataset.data.length + 1;
        if (parseInt(dataset.data[e]) > parseInt(colorChangeValue)) {
            dataset.backgroundColor[e] = chartColors.blue;
        }*/
        myChart.update();
    </script>


</body>
